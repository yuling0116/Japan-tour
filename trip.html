<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 å²¡å±±æ—…ä¼´ (V9.0 å¼·åŒ–ç·¨è¼¯ç‰ˆ) âœˆï¸</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e67e22;
            --bg-color: #f4f6f7;
            --card-bg: #ffffff;
            --text-color: #333;
            --btn-blue: #3498db;
            --btn-green: #2ecc71;
            --btn-red: #e74c3c;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* å°è¦½åˆ— */
        .header-bar {
            background: var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .date-tabs {
            display: flex;
            overflow-x: auto;
            padding: 10px 0;
        }

        .date-tab {
            background: transparent;
            color: rgba(255,255,255,0.7);
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 15px;
        }

        .date-tab.active {
            color: white;
            font-weight: bold;
            border-bottom: 3px solid var(--accent);
        }

        /* å…§å®¹å€ */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
            padding-bottom: 100px;
        }

        .location-header {
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .location-header:hover { background: #eef2f3; }
        .location-header h2 { margin: 0; color: var(--primary); }
        .location-header p { margin: 5px 0; color: #7f8c8d; font-size: 0.9em; }

        /* å¡ç‰‡è¨­è¨ˆ */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            border-left: 5px solid var(--accent);
            position: relative;
        }

        .time-box {
            min-width: 60px;
            font-weight: bold;
            color: var(--accent);
            font-size: 14px;
        }

        .content-box { flex: 1; margin-right: 10px; }
        .activity { font-weight: bold; margin-bottom: 4px; }
        .note { font-size: 0.85em; color: #7f8c8d; line-height: 1.4; }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            justify-content: center;
        }

        .btn-sm {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
        }

        /* åº•éƒ¨æŒ‰éˆ• */
        .fab-group {
            position: fixed;
            bottom: 25px;
            right: 20px;
            display: flex;
            gap: 12px;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            border: none;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .fab-add { background: var(--primary); }
        .fab-reset { background: var(--btn-red); font-size: 18px; }

        /* === ç·¨è¼¯å½ˆçª— (Modal) === */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
        }

        .modal-content h3 { margin-top: 0; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9em; }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }
        .btn-save { background: var(--btn-blue); color: white; }
        .btn-cancel { background: #eee; }

    </style>
</head>
<body>

<div class="header-bar">
    <div class="date-tabs" id="tabs-container"></div>
</div>

<div class="container">
    <div class="location-header" onclick="editDayHeader()">
        <h2 id="display-label">è®€å–ä¸­...</h2>
        <p id="display-location">é»æ“Šæ­¤è™•ç·¨è¼¯æ¨™é¡Œèˆ‡åœ°é»</p>
    </div>
    <div id="itinerary-list"></div>
</div>

<div class="fab-group">
    <button class="fab fab-reset" onclick="resetAll()">â†»</button>
    <button class="fab fab-add" onclick="openAddModal()">ï¼‹</button>
</div>

<div id="itemModal" class="modal">
    <div class="modal-content">
        <h3 id="modal-title">ç·¨è¼¯è¡Œç¨‹</h3>
        <input type="hidden" id="edit-index">
        <div class="form-group">
            <label>æ™‚é–“ (ä¾‹å¦‚ 09:00 æˆ– ä¸Šåˆ)</label>
            <input type="text" id="field-time">
        </div>
        <div class="form-group">
            <label>æ´»å‹•åœ°é»/å…§å®¹</label>
            <input type="text" id="field-activity">
        </div>
        <div class="form-group">
            <label>å‚™è¨» (é¸å¡«)</label>
            <textarea id="field-note" rows="3"></textarea>
        </div>
        <div class="form-group">
            <label>Google Map é€£çµ (é¸å¡«)</label>
            <input type="text" id="field-url" placeholder="https://...">
        </div>
        <div class="modal-footer">
            <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="btn btn-save" onclick="saveItem()">å„²å­˜è¡Œç¨‹</button>
        </div>
    </div>
</div>

<script>
    // é è¨­è³‡æ–™
    const defaultData = {
        "2026-01-10": { label: "1/10 (å…­)", location: "ğŸ“ å€‰æ•·", items: [{ time: "ä¸Šåˆ", activity: "æŠµé”å€‰æ•· â†’ å…¥ä½å°æœ¨å±‹", note: "å…ˆå¯„æ”¾è¡Œæ", url: "" }] },
        "2026-01-11": { label: "1/11 (æ—¥)", location: "ğŸ“ ç›´å³¶", items: [{ time: "08:00", activity: "å®‡é‡æ¸¯æ­èˆ¹", note: "å¾€ç›´å³¶", url: "" }] }
    };

    let currentData = {};
    let activeDateKey = "2026-01-10";
    const STORAGE_KEY = "trip_data_v9";

    function init() {
        const saved = localStorage.getItem(STORAGE_KEY);
        currentData = saved ? JSON.parse(saved) : defaultData;
        
        const keys = Object.keys(currentData).sort();
        if (!currentData[activeDateKey]) activeDateKey = keys[0];

        renderTabs();
        renderList();
    }

    function renderTabs() {
        const container = document.getElementById('tabs-container');
        container.innerHTML = '';
        Object.keys(currentData).sort().forEach(key => {
            const btn = document.createElement('button');
            btn.className = `date-tab ${key === activeDateKey ? 'active' : ''}`;
            btn.innerText = currentData[key].label;
            btn.onclick = () => { activeDateKey = key; renderTabs(); renderList(); };
            container.appendChild(btn);
        });
    }

    function renderList() {
        const day = currentData[activeDateKey];
        document.getElementById('display-label').innerText = day.label;
        document.getElementById('display-location').innerText = day.location;

        const list = document.getElementById('itinerary-list');
        list.innerHTML = '';

        // æ’åºé‚è¼¯
        day.items.sort((a, b) => timeToVal(a.time) - timeToVal(b.time));

        day.items.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="time-box">${item.time}</div>
                <div class="content-box">
                    <div class="activity">${item.activity}</div>
                    <div class="note">${item.note}</div>
                </div>
                <div class="actions">
                    <button class="btn-sm" onclick="openEditModal(${index})">âœï¸</button>
                    <button class="btn-sm" onclick="deleteItem(${index})">ğŸ—‘ï¸</button>
                </div>
            `;
            list.appendChild(card);
        });
    }

    // --- Modal æ§åˆ¶ ---
    function openAddModal() {
        document.getElementById('modal-title').innerText = "æ–°å¢è¡Œç¨‹";
        document.getElementById('edit-index').value = "-1";
        document.getElementById('field-time').value = "";
        document.getElementById('field-activity').value = "";
        document.getElementById('field-note').value = "";
        document.getElementById('field-url').value = "";
        document.getElementById('itemModal').style.display = 'flex';
    }

    function openEditModal(index) {
        const item = currentData[activeDateKey].items[index];
        document.getElementById('modal-title').innerText = "ç·¨è¼¯è¡Œç¨‹";
        document.getElementById('edit-index').value = index;
        document.getElementById('field-time').value = item.time;
        document.getElementById('field-activity').value = item.activity;
        document.getElementById('field-note').value = item.note;
        document.getElementById('field-url').value = item.url || "";
        document.getElementById('itemModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('itemModal').style.display = 'none';
    }

    function saveItem() {
        const idx = parseInt(document.getElementById('edit-index').value);
        const newItem = {
            time: document.getElementById('field-time').value || "æœªå®š",
            activity: document.getElementById('field-activity').value || "æ–°æ´»å‹•",
            note: document.getElementById('field-note').value,
            url: document.getElementById('field-url').value
        };

        if (idx === -1) {
            currentData[activeDateKey].items.push(newItem);
        } else {
            currentData[activeDateKey].items[idx] = newItem;
        }

        saveAndSync();
        closeModal();
    }

    function deleteItem(index) {
        if (confirm("ç¢ºå®šåˆªé™¤é€™é …è¡Œç¨‹å—ï¼Ÿ")) {
            currentData[activeDateKey].items.splice(index, 1);
            saveAndSync();
        }
    }

    function editDayHeader() {
        const day = currentData[activeDateKey];
        const newLabel = prompt("ä¿®æ”¹æ—¥æœŸé¡¯ç¤º (å¦‚: 1/10 å…­):", day.label);
        if (newLabel === null) return;
        const newLoc = prompt("ä¿®æ”¹åœ°é» (å¦‚: ğŸ“ å€‰æ•·):", day.location);
        if (newLoc === null) return;
        
        day.label = newLabel;
        day.location = newLoc;
        saveAndSync();
        renderTabs();
    }

    function saveAndSync() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(currentData));
        renderList();
    }

    function resetAll() {
        if (confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ”¹å‹•ä¸¦é‡ç½®å—ï¼Ÿ")) {
            localStorage.removeItem(STORAGE_KEY);
            location.reload();
        }
    }

    function timeToVal(s) {
        const t = s.trim().toLowerCase();
        if (t.match(/^\d/)) {
            const p = t.split(':');
            return parseInt(p[0]) * 60 + (parseInt(p[1]) || 0);
        }
        if (t.includes("ä¸Š")) return 600;
        if (t.includes("ä¸­")) return 720;
        if (t.includes("ä¸‹")) return 840;
        if (t.includes("æ™š")) return 1100;
        return 9999;
    }

    init();
</script>
</body>
</html>
